# 侧边栏设置

## 1. 基本设置

在聊天界面中，您可以点击顶部栏的设置图标打开侧边栏设置面板。这个面板提供了丰富的功能选项，让您可以自定义聊天体验。

### 1.1 界面控制

1. **显示顶部栏**：控制聊天界面顶部栏的显示或隐藏。隐藏顶部栏可以获得更沉浸的聊天体验。
2. **显示设置**：选择聊天界面的显示模式：
   - **常规模式**：标准聊天界面布局
   - **背景强调**：突出显示背景图片，适合观赏精美背景
   - **视觉小说**：类似于视觉小说/Galgame的对话框风格

### 1.2 个性化设置

1. **角色对我的称呼**：自定义角色如何称呼您。设置后，角色会在对话中使用这个名字称呼您。
   - 输入您想要的称呼
   - 点击"保存"按钮应用更改

## 2. 视觉设置

### 2.1 角色外观

1. **动态立绘**：使用视频替代静态角色立绘，使角色更加生动。
   - 开启此功能后可选择或更换动态立绘视频
   - 视频会循环播放，增强角色的生动感

### 2.2 图像生成

1. **自动生成背景**：根据对话内容自动生成匹配的背景图片
   - 系统会分析对话内容，生成符合情境的背景
   - 背景图随对话主题变化而更新

2. **自动生成图片**：AI在对话中自动生成相关图片
   - 根据对话内容自动生成相关的图片
   - 适合需要图像辅助表达的场景

3. **自定义生成图片**：允许角色根据您的描述生成定制图片
   - 您可以请求角色为特定描述生成图片
   - 生成的图片可以保存到相册

## 3. 聊天设置

### 3.1 记忆功能

1. **记忆总结**：帮助AI在长对话中保持记忆连贯性
   - 系统会自动总结过去的对话内容，保持AI的记忆
   - 对于长时间对话特别有用
   - 您也可以点击"立即总结"按钮手动触发总结
   - 总结功能有助于AI保持对话上下文，避免遗忘重要信息

### 3.2 互动设置

1. **主动消息**：角色会在您一段时间不回复后主动发送消息
   - 可设置触发时间（1-30分钟）
   - 角色会根据`自动消息提示词`和上下文自然地发起对话
   - 增强角色的真实感和主动性

2. **消息提醒**：当角色发送主动消息时，接收通知提醒
   - 开启后，即使应用在后台运行，也能收到角色的新消息通知
   - 关闭后，不会收到推送通知

## 4. 自设功能

自设功能允许您创建自己的角色设定，让AI更好地了解您。

### 4.1 基本设置

1. **自设功能开关**：启用或禁用自设功能
2. **全局应用**：开启后，所有角色都会接收到您的自设；关闭后仅当前角色接收

### 4.2 自设内容配置

1. **自设标题**：自设的标题名称，默认为"自设"
2. **自设内容**：输入您对自己的描述和设定
3. **插入位置**：选择自设在对话中插入的位置（0-4），推荐使用4
   - 位置4代表在对话内按深度动态插入
4. **插入深度**：选择自设插入的深度（0-3）
   - 0: 在最新消息后
   - 1: 在上一条用户消息前
   - 2+: 在更早消息前

配置完成后，点击"保存自设"按钮应用更改。

## 5. 工具提示词设置

工具提示词设置是一个高级功能，允许您自定义AI的行为模式。该界面包含三个主要功能模块，每个模块都有详细的配置选项和测试功能。

### 5.1 界面导航

工具提示词设置界面分为三个标签页：

1. **自动消息**：配置AI主动发送消息的行为
2. **记忆总结**：配置AI总结长对话内容的方式
3. **图像生成**：配置AI生成图像提示词的规则

每个标签页都有独立的配置项和操作按钮。

### 5.2 自动消息提示词

自动消息功能让AI能够在用户长时间未回复时主动发起对话，增强角色的真实感和互动性。

#### 5.2.1 基本配置

1. **指令文本框**：输入自动消息生成的指令
   - 默认指令：`[AUTO_MESSAGE] 用户已经一段时间没有回复了。请基于上下文和你的角色设定，主动发起一条合适的消息。这条消息应该自然，不要直接提及用户长时间未回复的事实。`
   - 该指令作为隐藏的用户消息发送给AI，不会在聊天界面显示
   - 您可以根据需要修改指令内容，调整AI的行为模式

2. **自动消息发送间隔**：设置触发自动消息的时间间隔（单位：分钟）
   - 默认值：5分钟
   - 当用户在设定时间内未回复时，AI会根据配置的提示词主动发送消息

#### 5.2.2 功能按钮详解

标题栏右侧有六个功能按钮，从左到右分别是：

1. **📄 导入Preset按钮**：
   - 功能：导入角色预设文件（JSON格式）
   - 用途：为自动消息提供角色背景信息，使生成的消息更符合角色设定
   - 操作：点击后选择本地的角色预设文件

2. **📚 导入WorldBook按钮**：
   - 功能：导入世界观设定文件（JSON格式）
   - 用途：为自动消息提供世界观背景，丰富对话内容
   - 操作：点击后选择本地的世界观文件

3. **🗑️ 清空Preset按钮**：
   - 功能：清除已导入的角色预设
   - 用途：当您想要使用纯指令模式时，可以清空预设
   - 状态：只有导入了预设后才会激活
   - 效果：清空后可以只使用指令文本生成消息数组

4. **❌ 清空WorldBook按钮**：
   - 功能：清除已导入的世界观设定
   - 用途：简化配置，专注于角色和指令
   - 状态：只有导入了世界观文件后才会激活

5. **⚙️ 生成消息数组按钮**：
   - 功能：根据当前配置生成用于API调用的消息数组
   - 工作原理：
     - 如果只有指令文本：生成简单的用户消息数组
     - 如果有预设：使用NodeSTCore构建完整的消息框架
   - 状态：生成过程中按钮变灰，显示加载状态

6. **⚡ API测试按钮**：
   - 功能：使用当前配置测试API调用
   - 前提：必须先生成消息数组
   - 用途：验证配置是否正确，预览AI的响应效果
   - 响应：测试结果会显示在界面底部的"API响应"区域

#### 5.2.3 操作流程

1. **基础配置流程**：
   ```
   输入指令 → 设置间隔时间 → 生成消息数组 → 保存配置
   ```

2. **高级配置流程**：
   ```
   输入指令 → 导入Preset → 导入WorldBook → 生成消息数组 → API测试 → 保存配置
   ```

### 5.3 记忆总结提示词

记忆总结功能帮助AI在长对话中保持记忆连贯性，通过定期总结对话内容来避免上下文丢失。

#### 5.3.1 基本配置

1. **指令文本框**：配置总结生成的规则
   - 默认指令详细说明了总结的要求：提取关键信息、保持连续性、保留情感等
   - 指令质量直接影响总结效果

2. **记忆服务设置**：
   - **总结阈值**：当对话字符数达到此值时触发自动总结（默认6000字符）
   - **总结长度**：生成的总结文本长度限制（默认1000字符）
   - **自定义总结区间**：可以指定总结特定范围的消息，而不是全部对话

#### 5.3.2 高级选项

**启用自定义总结区间**：
- 开启后可以精确控制总结哪些消息
- **起始索引**：从第几条消息开始总结（默认第3条）
- **结束索引**：到第几条消息结束总结（默认第10条）
- 用途：避免总结过于久远或过于新近的消息，专注于特定对话段落

#### 5.3.3 功能按钮

记忆总结的按钮功能与自动消息相同，但针对总结任务进行了优化：

1. **导入文件按钮**：为总结提供角色和世界观上下文
2. **生成消息数组**：构建适合总结任务的消息格式
3. **API测试**：验证总结效果，确保输出符合预期

### 5.4 图像生成提示词

图像生成功能让AI能够根据对话内容生成图像描述，用于自动图片生成服务。

#### 5.4.1 功能说明

1. **指令内容**：
   - 默认指令要求AI分析最近10条对话
   - 生成不超过15个英文单词的图像描述
   - 专注于表情、动作、场景，不描述外观服饰

2. **应用场景**：
   - 自动背景生成
   - 角色表情变化
   - 场景氛围营造

#### 5.4.2 配置要点

1. **描述精度**：指令要求生成简洁的英文描述，适合图像生成AI理解
2. **内容限制**：避免描述固定的外观特征，专注于动态变化的元素
3. **上下文分析**：基于recent messages变量分析对话状态

### 5.5 通用操作说明

#### 5.5.1 保存和加载

1. **自动保存**：所有配置都会自动保存到本地存储
2. **配置加载**：应用启动时自动加载上次的配置
3. **适配器同步**：会自动从API设置中读取当前使用的AI服务提供商

#### 5.5.2 错误处理

1. **错误显示**：操作失败时会在界面底部显示详细错误信息
2. **状态反馈**：按钮状态会反映当前操作的可用性
3. **加载指示**：长时间操作会显示loading状态

#### 5.5.3 测试和验证

1. **API测试**：每个模块都提供API测试功能，用于验证配置效果
2. **响应查看**：测试结果会显示在可滚动的文本区域中
3. **实时反馈**：测试过程中会显示加载状态

## 6. 操作技巧

1. **侧边栏关闭**：点击侧边栏外区域或从顶部向下滑动可关闭侧边栏
2. **设置同步**：所有设置会自动保存，在下次对话中保持生效
3. **组合使用**：尝试组合不同设置，创造最适合您的聊天体验
   - 例如：视觉小说模式 + 动态立绘 + 自动背景生成可创造沉浸式视觉体验
   - 主动消息 + 消息提醒可以让角色更加活跃，即使在您不活跃时也能保持互动
4. **工具提示词优化建议**：
   - 先使用默认指令测试效果，再根据需要进行调整
   - 导入预设和世界观文件可以显著提升AI响应质量
   - 定期测试API确保配置正常工作
   - 根据对话长度调整记忆总结的阈值设置

## 7. 常见问题

### 7.1 功能相关问题

1. **动态立绘视频格式要求是什么？**  
   支持大多数常见视频格式，建议使用MP4格式，尺寸与原立绘比例相符，时长建议30秒以内以节省资源。

2. **记忆总结会影响聊天效果吗？**  
   记忆总结有助于AI保持长对话的连贯性，但可能会略微增加响应时间。如果您的对话较短，可以关闭此功能。

3. **自设内容有字数限制吗？**  
   虽然没有严格限制，但太长的自设可能会被AI忽略重要部分。

### 7.2 工具提示词相关问题

4. **为什么需要导入Preset和WorldBook？**  
   Preset提供角色背景信息，WorldBook提供世界观设定。导入这些文件可以让AI生成更加符合角色设定和世界观的响应，提升对话质量。

5. **消息数组是什么？有什么作用？**  
   消息数组是发送给AI的完整对话上下文，包含系统指令、角色设定、历史对话等信息。生成消息数组是为了让AI能够理解完整的对话背景。

6. **API测试失败怎么办？**  
   - 检查网络连接是否正常
   - 确认API设置中的密钥和服务地址正确
   - 验证消息数组是否已正确生成
   - 查看错误信息获取具体失败原因

7. **自动消息间隔时间如何设置最合适？**  
   建议设置5-15分钟。太短可能会打扰用户，太长可能会失去互动的及时性。可以根据个人使用习惯调整。

### 7.3 使用技巧问题

8. **如何有效使用自设功能？**  
   自设应该简洁明了地描述您希望角色了解的信息，包括身份、性格、喜好等，避免与角色设定冲突的内容。

9. **自动生成的图片和背景不满意怎么办？**  
   您可以关闭自动生成功能，改为手动添加图片，或尝试调整对话内容以引导生成更符合期望的图像。也可以在工具提示词设置中调整图像生成的指令。

10. **记忆总结的区间设置如何选择？**  
    一般建议总结中间段落的对话，避免总结最新的几条消息（可能还在发展中）和最早的消息（可能已经不太相关）。起始索引3-5，结束索引8-12是比较合适的范围。

### 7.4 故障排除问题

11. **为什么有些设置不生效？**  
    某些设置可能需要重新启动对话才能完全生效，特别是影响上下文处理的设置，如自设和记忆总结。

12. **工具提示词配置丢失怎么办？**  
    所有配置都保存在本地存储中，如果配置丢失，可能是由于应用数据被清除。建议定期使用API测试功能验证配置是否正常。

13. **导入的文件格式不正确怎么办？**  
    确保导入的是标准的JSON格式文件，且文件结构符合角色预设或世界观设定的标准格式。如果不确定格式是否正确，可以先生成消息数组测试。
