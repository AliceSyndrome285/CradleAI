# 角色编辑助手

## 1. 功能概述

角色编辑助手能够通过自然语言对话的方式修改和完善角色设定。

### 1.1 主要功能

1. **智能对话编辑**：通过自然语言与AI助手交流，描述您想要的修改
2. **实时预览**：在应用更改前预览所有修改内容
3. **组件化更新**：支持分别更新角色基本信息、世界书条目和自定义提示
4. **多角色类型支持**：兼容普通角色和摇篮系统角色
5. **历史记录保存**：自动保存编辑对话历史

### 1.2 适用场景

- 调整角色性格和行为特征
- 丰富角色背景故事和设定
- 修改角色的对话风格和语言习惯
- 添加或修改世界书条目
- 自定义角色的提示词和行为模式

## 2. 基本操作

### 2.1 打开编辑助手

1. 在角色列表中找到要编辑的角色
2. 点击角色卡片上的"编辑"按钮或相关操作按钮
3. 角色编辑助手将以全屏模式打开

### 2.2 界面布局

**顶部栏**
- 角色名称显示
- 刷新对话按钮（清除聊天记录）
- 关闭按钮

**操作栏**
- **预览更改**：查看生成的角色修改内容
- **应用更改**：将修改应用到角色
- **生成更改**：基于对话内容生成角色更新

**聊天区域**
- 显示与AI助手的对话
- 支持背景图片显示（如果角色有设置）
- 消息气泡显示发送时间

**输入区域**
- 文本输入框（支持多行输入，最多1000字符）
- 发送按钮

## 3. 使用流程

### 3.1 开始编辑对话

1. **系统欢迎**：打开编辑助手后，AI会发送欢迎消息并介绍可用功能
2. **描述需求**：在输入框中描述您想要的修改，例如：
   - "让这个角色更加活泼开朗"
   - "为角色添加一个悲伤的背景故事"
   - "修改角色的说话风格，让她更有礼貌"

### 3.2 与AI助手交流

1. **发送消息**：输入您的修改需求并点击发送按钮
2. **AI分析**：助手会分析您的需求并提供建议或询问细节
3. **持续对话**：根据AI的反馈继续完善您的需求
4. **确认修改**：当AI理解您的需求后，会生成具体的修改方案

### 3.3 生成和预览更改

1. **自动生成**：AI在理解您的需求后会自动生成角色更新
2. **手动触发**：如果没有自动生成，可以点击"生成更改"按钮
3. **状态指示**：操作栏按钮会显示是否有可用的更改（✓标记）
4. **预览内容**：点击"预览更改"查看具体的修改内容

## 4. 预览功能详解

### 4.1 预览界面组成

**更新组件标签**
- 显示哪些部分被修改（基本信息、世界书条目、自定义提示）
- 彩色标签直观展示更新范围

**基本信息预览**
- 角色名称、描述、性格
- 场景设定、初始消息
- 对话示例（如有修改）

**世界书条目预览**
- 显示新增或修改的条目
- 条目名称、类型说明和具体内容
- 支持多个条目同时预览

**自定义提示预览**
- 显示新增或修改的提示词
- 区分用户提示和模型提示
- 显示提示的具体内容

### 4.2 预览操作

1. **关闭预览**：返回对话界面继续编辑
2. **应用更改**：确认修改并更新角色

## 5. 应用更改功能

### 5.1 更改应用流程

1. **数据验证**：系统自动验证生成的角色数据格式
2. **结构修复**：自动补充缺失的必要数据结构
3. **合并更新**：将新数据与原有数据智能合并
4. **多角色同步**：如果是摇篮角色，会同时更新关联的普通角色
5. **存储更新**：将修改保存到本地存储和系统中

### 5.2 更新内容类型

**roleCard更新**
- 角色基本信息（名称、描述、性格）
- 场景设定和背景故事
- 初始消息和对话示例

**worldBook更新**
- 新增世界书条目
- 修改现有条目内容
- 自动添加必要的技术参数

**preset更新**
- 新增自定义提示词
- 修改现有提示内容
- 自动维护提示词顺序

## 6. 高级功能

### 6.1 智能建议系统

1. **主动分析**：AI会主动分析角色设定并提出改进建议
2. **上下文理解**：基于对话历史提供针对性建议
3. **设定完善**：自动识别角色设定中的不足之处

### 6.2 多组件更新

1. **选择性更新**：可以只更新角色的特定部分
2. **组件独立**：基本信息、世界书、提示词可独立更新
3. **增量修改**：保留原有数据，只修改指定部分

### 6.3 历史记录管理

1. **自动保存**：对话历史自动保存到本地
2. **刷新清理**：可以清除聊天记录重新开始
3. **角色关联**：每个角色的编辑历史独立保存


## 7. 常见问题解答

### 7.1 功能使用问题

1. **AI不理解我的需求怎么办？**  
   尝试更详细地描述您的需求，提供具体的例子或场景。可以分步骤说明，让AI逐步理解您的意图。

2. **生成的更改不符合预期怎么办？**  
   在预览阶段仔细检查，如果不满意可以关闭预览继续与AI对话，进一步说明您的需求。

3. **如何修改角色的特定方面？**  
   明确指出要修改的部分，如"只修改性格，不要改变背景故事"或"只添加世界书条目"。

### 7.2 数据安全问题

7. **修改后的数据会丢失吗？**  
   所有修改都会自动保存到本地存储。建议定期备份重要角色数据。

8. **可以撤销修改吗？**  
   目前不支持自动撤销，建议在重大修改前手动备份角色。

9. **对话历史会被保存吗？**  
   是的，每个角色的编辑对话历史都会单独保存，下次打开时会自动加载。

## 8. 故障排除

### 8.1 常见错误处理

**"无法解析JSON更新内容"错误**
- 原因：AI生成的数据格式有误
- 解决：重新描述需求，或尝试点击"生成更改"按钮

**"NodeSTManager处理失败"错误**
- 原因：API连接问题或密钥配置错误
- 解决：检查网络连接和API设置
